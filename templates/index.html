{% extends 'base.html' %}

{% block title %}Home Page{% endblock %}

{% block content %}

<style>
    body {
        background-image: url('https://img.freepik.com/premium-photo/health-insurance-concept-reduce-medical-expenses-hand-flip-wood-cube-with-icon-healthcare-medical-coin-wood-background-copy-space_52701-34.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        height: 100vh;
        margin: 0;
    }
    .container {
        display: flex;
        flex-wrap:wrap;
        justify-content: center;
        gap:20px;
        margin:20px;
    }
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        width: 25rem;
        color: black;
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 10px;
        padding: 20px;
        margin: 20px;
    }
    .card-body {
        padding: 20px;
    }
    button {
        background-color: #f44336;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
    }
    button:hover {
        background-color: #d32f2f;
    }
    .add-form {
        margin: 20px;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
    }
</style>

<div class="container">
    <div class="add-form">
        <h4>Add a New Details</h4>
        <input type="number" id="newAge" placeholder="Age"><br>
        <input type="number" id="newBmi" placeholder="BMI">
        <input type="number" id="newChildren" placeholder="Children"><br>
        <input type="number" id="newCharges" placeholder="Charges">
        <input type="text" id="newRegion" placeholder="Region"><br>
        <button onclick="addPatient()">Add</button>
    </div>
    <div class="row">
        {% for patient in content %}
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Age: {{ patient.age }}</h5>
            <p class="card-text">BMI: {{ patient.bmi }}</p>
            <p class="card-text">Children: {{ patient.children }}</p>
            <p class="card-text">Charges: {{ patient.charges }}</p>
            <p class="card-text">Region: {{ patient.region }}</p>
            <p class="card-text">
                <button onclick="confirmDelete({{ patient.id }})">Delete</button>
                <button onclick="editPatient({{ patient.id }}, '{{ patient.age }}', '{{ patient.bmi }}', '{{ patient.children }}', '{{ patient.charges }}', '{{ patient.region }}')">Edit</button>
            </p>
          </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Delete patient
    function confirmDelete(patientId) {
        const confirmation = confirm("Are you sure you want to delete this patient?");
        if (confirmation) {
            fetch(`/delete/${patientId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.message === 'Patient deleted successfully') {
                    window.location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }

    // Add a new patient
    function addPatient() {
        const newAge = document.getElementById("newAge").value;
        const newBmi = document.getElementById("newBmi").value;
        const newChildren = document.getElementById("newChildren").value;
        const newCharges = document.getElementById("newCharges").value;
        const newRegion = document.getElementById("newRegion").value;

        fetch('/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                age: newAge,
                bmi: newBmi,
                children: newChildren,
                charges: newCharges,
                region: newRegion
            })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            if (data.message === 'Patient added successfully') {
                window.location.reload();
            }
        })
        .catch(error => console.error('Error:', error));
    }

    // Edit a patient
    function editPatient(id, age, bmi, children, charges, region) {
        const updatedAge = prompt("Enter new Age:", age);
        const updatedBmi = prompt("Enter new BMI:", bmi);
        const updatedChildren = prompt("Enter new Children count:", children);
        const updatedCharges = prompt("Enter new Charges:", charges);
        const updatedRegion = prompt("Enter new Region:", region);

        if (updatedAge && updatedBmi && updatedChildren && updatedCharges && updatedRegion) {
            fetch(`/update/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    age: updatedAge,
                    bmi: updatedBmi,
                    children: updatedChildren,
                    charges: updatedCharges,
                    region: updatedRegion
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.message === 'Patient updated successfully') {
                    window.location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }
</script>

{% endblock %}
